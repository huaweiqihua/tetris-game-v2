<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>俄罗斯方块</title>
    <style>
        * { box-sizing: border-box; touch-action: manipulation; margin: 0; padding: 0; }
        html, body { height: 100%; overflow: hidden; background: #1a1a2e; }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            font-family: 'Segoe UI', sans-serif;
            color: #eee;
            padding: 10px;
            height: 100vh;
        }
        
        /* 顶部信息栏 */
        #top-bar {
            display: flex;
            gap: 30px;
            align-items: center;
            width: 100%;
            justify-content: center;
            padding: 5px 0;
        }
        .stat { text-align: center; }
        .stat-label { font-size: 11px; color: #888; }
        .stat-value { font-size: 20px; font-weight: bold; color: #0ff; }
        
        #start-btn {
            background: linear-gradient(135deg, #0ff, #06f);
            border: none; padding: 8px 25px;
            color: white; font-size: 14px;
            border-radius: 20px; cursor: pointer;
        }
        
        /* 游戏区域 */
        #game-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        canvas { 
            border: 3px solid #0ff; 
            box-shadow: 0 0 25px rgba(0,255,255,0.4); 
            background: #0a0a15; 
        }
        
        /* 方向键 - 大尺寸 */
        #controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 350px;
            padding-bottom: 15px;
        }
        
        .ctrl-btn {
            background: linear-gradient(180deg, #1e3a5f, #0d2137);
            border: 2px solid #0ff; color: #0ff;
            font-size: 28px;
            border-radius: 12px;
            cursor: pointer;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ctrl-btn:active { background: #0ff; color: #1a1a2e; }
        
        /* 旋转按钮特殊样式 */
        .rotate-btn {
            background: linear-gradient(180deg, #3d1a5f, #2a0d47);
            border-color: #d0f !important;
            color: #d0f !important;
        }
        
        #game-over {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 100;
        }
        #game-over.show { display: flex; }
        #game-over h2 { color: #f00; font-size: 32px; margin-bottom: 20px; }
        #final-score { font-size: 24px; color: #0ff; margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- 顶部信息 -->
    <div id="top-bar">
        <div class="stat"><div class="stat-label">分数</div><div class="stat-value" id="score">0</div></div>
        <div class="stat"><div class="stat-label">等级</div><div class="stat-value" id="level">1</div></div>
        <div class="stat"><div class="stat-label">行数</div><div class="stat-value" id="lines">0</div></div>
        <button id="start-btn" ontouchstart="startGame()">开始</button>
    </div>
    
    <!-- 游戏画布 -->
    <div id="game-container">
        <canvas id="game" width="280" height="480"></canvas>
    </div>
    
    <!-- 控制按钮 -->
    <div id="controls">
        <div></div>
        <button class="ctrl-btn rotate-btn" ontouchstart="rotateP()">↻ 旋转</button>
        <div></div>
        <button class="ctrl-btn" ontouchstart="move(-1)">← 左</button>
        <button class="ctrl-btn" ontouchstart="drop()">↓ 下</button>
        <button class="ctrl-btn" ontouchstart="move(1)">→ 右</button>
    </div>

    <div id="game-over">
        <h2>游戏结束</h2>
        <div id="final-score">0</div>
        <button class="ctrl-btn" style="width:150px;height:50px;font-size:18px;" ontouchstart="startGame()">再来一局</button>
    </div>

    <script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const COLS = 7;
const ROWS = 16;
const BLOCK = 30;

const SHAPES = [[[1,1,1,1]],[[1,1],[1,1]],[[1,1,1],[0,1,0]],[[1,1,1],[1,0,0]],[[1,1,1],[0,0,1]],[[1,1,0],[0,1,1]],[[0,1,1],[1,1,0]]];
const COLORS = ['#0ff','#ff0','#f0f','#0f0','#f00','#00f','#fa0'];

let board = [], piece = null, score = 0, level = 1, lines = 0, gameOver = false, running = false, dropInterval = 800, lastDrop = 0;

function initBoard() { board = []; for(let r=0;r<ROWS;r++){board[r]=[];for(let c=0;c<COLS;c++)board[r][c]=null;} }
function init(){initBoard();score=0;level=1;lines=0;dropInterval=800;gameOver=false;updateScore();draw();}
function newPiece(){const idx=Math.floor(Math.random()*SHAPES.length);const shape=[];for(let i=0;i<SHAPES[idx].length;i++)shape[i]=SHAPES[idx][i].slice();const color=COLORS[idx];const startX=Math.floor((COLS-shape[0].length)/2);return{shape,color,x:startX,y:0};}
function drawCell(c,r,color){if(color){ctx.fillStyle=color;ctx.fillRect(c*BLOCK+1,r*BLOCK+1,BLOCK-2,BLOCK-2);ctx.fillStyle='rgba(255,255,255,0.3)';ctx.fillRect(c*BLOCK+1,r*BLOCK+1,BLOCK-2,4);ctx.fillRect(c*BLOCK+1,r*BLOCK+1,4,BLOCK-2);}}
function draw(){ctx.fillStyle='#0a0a15';ctx.fillRect(0,0,canvas.width,canvas.height);for(let r=0;r<ROWS;r++)for(let c=0;c<COLS;c++)if(board[r][c])drawCell(c,r,board[r][c]);if(piece){for(let y=0;y<piece.shape.length;y++)for(let x=0;x<piece.shape[y].length;x++)if(piece.shape[y][x])drawCell(piece.x+x,piece.y+y,piece.color);}}
function canMove(ox,oy){for(let y=0;y<piece.shape.length;y++)for(let x=0;x<piece.shape[y].length;x++){if(piece.shape[y][x]){const nx=piece.x+x+ox,ny=piece.y+y+oy;if(nx<0||nx>=COLS||ny>=ROWS)return false;if(ny>=0&&board[ny][nx]!==null)return false;}}return true;}
function rotate(){const old=piece.shape,newS=[];for(let x=0;x<old[0].length;x++){newS[x]=[];for(let y=old.length-1;y>=0;y--)newS[x].push(old[y][x]);}piece.shape=newS;if(!canMove(0,0)){if(canMove(-1,0))piece.x-=1;else if(canMove(1,0))piece.x+=1;else piece.shape=old;}}
function lock(){for(let y=0;y<piece.shape.length;y++)for(let x=0;x<piece.shape[y].length;x++){if(piece.shape[y][x]){const py=piece.y+y,px=piece.x+x;if(py>=0&&py<ROWS&&px>=0&&px<COLS)board[py][px]=piece.color;}}for(let r=ROWS-1;r>=0;r--){let full=true;for(let c=0;c<COLS;c++)if(board[r][c]===null){full=false;break;}if(full){for(let rr=r;rr>0;rr--)for(let c=0;c<COLS;c++)board[rr][c]=board[rr-1][c];for(let c=0;c<COLS;c++)board[0][c]=null;lines++;score+=100*level;r++;}}if(lines>=level*5){level++;dropInterval=Math.max(100,800-(level-1)*70);}updateScore();piece=newPiece();if(!canMove(0,0)){gameOver=true;document.getElementById('final-score').textContent='得分: '+score;document.getElementById('game-over').classList.add('show');}}
function updateScore(){document.getElementById('score').textContent=score;document.getElementById('level').textContent=level;document.getElementById('lines').textContent=lines;}
function move(dir){if(!running||gameOver||!piece)return;if(canMove(dir,0)){piece.x+=dir;draw();}}
function tick(){if(!running||gameOver)return;if(canMove(0,1))piece.y++;else lock();draw();}
function drop(){if(!running||gameOver||!piece)return;if(canMove(0,1)){piece.y++;draw();}else{lock();draw();}}
function hardDrop(){if(!running||gameOver||!piece)return;while(canMove(0,1))piece.y++;lock();draw();}
function rotateP(){if(!running||gameOver||!piece)return;rotate();draw();}
function gameLoop(timestamp){if(!running||gameOver)return;if(timestamp-lastDrop>dropInterval){tick();lastDrop=timestamp;}requestAnimationFrame(gameLoop);}
function startGame(){init();piece=newPiece();running=true;lastDrop=performance.now();document.getElementById('game-over').classList.remove('show');document.getElementById('start-btn').textContent='重玩';draw();requestAnimationFrame(gameLoop);}
document.addEventListener('keydown',e=>{if(!running||gameOver)return;if(e.key==='ArrowLeft')move(-1);if(e.key==='ArrowRight')move(1);if(e.key==='ArrowDown')drop();if(e.key==='ArrowUp'||e.key===' '){e.preventDefault();rotateP();}});
init();
    </script>
</body>
</html>
